<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Check-in</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#f2f2f2; padding:20px }
.card {
  background:#fff; padding:20px; border-radius:10px;
  max-width:420px; margin:auto; box-shadow:0 2px 10px rgba(0,0,0,.2)
}
.ok { color:green } .error{color:red}
button {
  background:#2196f3; color:#fff; border:none;
  padding:10px 15px; border-radius:6px; cursor:pointer
}
</style>
</head>
<body>

<div class="card" id="app"><h2>Validando...</h2></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwagu6s4ikyTdI3ZBlkpIYGNjB4u70wDKUvFzpcOT8We7paW4SyfG38MOKi8zn6XB8M8Q/exec";
const code = new URLSearchParams(location.search).get("code");

fetch(`${API_URL}?api=1&code=${code}`)
.then(r=>r.json())
.then(res=>{
  if(!res.ok){
    app.innerHTML=`<p class="error">${res.mensaje}</p>`;
    return;
  }

  const d = res.data;
  const texto = `
ACCESO AUTORIZADO
Nombre: ${d.nombre}
Tipo: ${d.tipoPago}
Usos restantes hoy: ${d.usosRestantes}
`;

  app.innerHTML = `
    <h2 class="ok">${res.mensaje}</h2>
    <pre id="txt">${texto}</pre>
    <button onclick="descargar()">Descargar comprobante</button>
  `;
});

function descargar(){
  const t=document.getElementById("txt").innerText;
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([t],{type:"text/plain"}));
  a.download="comprobante.txt";
  a.click();
}
</script>

</body>
</html>
