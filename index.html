<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Check-in</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#f2f2f2; padding:20px }
.card {
  background:#fff; padding:20px; border-radius:10px;
  max-width:420px; margin:auto; box-shadow:0 2px 10px rgba(0,0,0,.2)
}
.ok { color:green } .error{color:red}
button {
  background:#2196f3; color:#fff; border:none;
  padding:10px 15px; border-radius:6px; cursor:pointer
}
</style>
</head>
<body>

<div class="card" id="app"><h2>Validando QR...</h2></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwPsk0IO3WtDdt5CGd9P2zgFn4mqIo8Ewwxh1LpjDU78SA0tXwVC0-t5soOoR-7eHR0QA/exec";
const code = new URLSearchParams(window.location.search).get("code");

if (!code) {
  document.getElementById("app").innerHTML =
    "<p class='error'>QR inválido</p>";
} else {
  fetch(`${API_URL}?api=1&code=${code}`)
    .then(r => r.json())
    .then(res => {
      if (!res.ok) {
        document.getElementById("app").innerHTML =
          `<p class='error'>${res.mensaje}</p>`;
        return;
      }

      const d = res.data;
      document.getElementById("app").innerHTML = `
        <h2 class="ok">${res.mensaje}</h2>
        <pre>
Nombre: ${d.nombre}
Pastor: ${d.pastor || "-"}
WhatsApp: ${d.whatsapp || "-"}
Tipo de pago: ${d.tipoPago}
Usos restantes hoy: ${d.usosRestantes}

Integrantes:
${d.integrantes || "No aplica"}
        </pre>
      `;
    })
    .catch(() => {
      document.getElementById("app").innerHTML =
        "<p class='error'>Error de conexión</p>";
    });
}
</script>

</body>
</html>
